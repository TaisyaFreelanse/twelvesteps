"""Update step titles in the database."""
import asyncio
import os
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker
from sqlalchemy import select, update
from db.models import Step

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql+asyncpg://postgres:password@postgres:5432/twelvesteps")

# –ù–∞–∑–≤–∞–Ω–∏—è —à–∞–≥–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ 12 —à–∞–≥–æ–≤ (–ê–ù/–ê–ê)
STEP_TITLES = {
    1: {
        "title": "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –±–µ—Å—Å–∏–ª–∏—è",
        "description": "–ú—ã –ø—Ä–∏–∑–Ω–∞–ª–∏ —Å–≤–æ—ë –±–µ—Å—Å–∏–ª–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é, –ø—Ä–∏–∑–Ω–∞–ª–∏, —á—Ç–æ –Ω–∞—à–∞ –∂–∏–∑–Ω—å —Å—Ç–∞–ª–∞ –Ω–µ—É–ø—Ä–∞–≤–ª—è–µ–º–æ–π."
    },
    2: {
        "title": "–í–µ—Ä–∞ –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", 
        "description": "–ú—ã –ø—Ä–∏—à–ª–∏ –∫ —É–±–µ–∂–¥–µ–Ω–∏—é, —á—Ç–æ —Ç–æ–ª—å–∫–æ –°–∏–ª–∞, –±–æ–ª–µ–µ –º–æ–≥—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è, —á–µ–º –º—ã —Å–∞–º–∏, –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–∞–º –∑–¥—Ä–∞–≤–æ–º—ã—Å–ª–∏–µ."
    },
    3: {
        "title": "–†–µ—à–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ—é –≤–æ–ª—é",
        "description": "–ú—ã –ø—Ä–∏–Ω—è–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–µ–ø–æ—Ä—É—á–∏—Ç—å –Ω–∞—à—É –≤–æ–ª—é –∏ –Ω–∞—à—É –∂–∏–∑–Ω—å –∑–∞–±–æ—Ç–µ –ë–æ–≥–∞, –∫–∞–∫ –º—ã –ï–≥–æ –ø–æ–Ω–∏–º–∞–µ–º."
    },
    4: {
        "title": "–ë–µ—Å—Å—Ç—Ä–∞—à–Ω–∞—è –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è",
        "description": "–ú—ã –≥–ª—É–±–æ–∫–æ –∏ –±–µ—Å—Å—Ç—Ä–∞—à–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–ª–∏ —Å–µ–±—è —Å –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è."
    },
    5: {
        "title": "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –æ—à–∏–±–æ–∫",
        "description": "–ú—ã –ø—Ä–∏–∑–Ω–∞–ª–∏ –ø–µ—Ä–µ–¥ –ë–æ–≥–æ–º, —Å–æ–±–æ–π –∏ –∫–∞–∫–∏–º-–ª–∏–±–æ –¥—Ä—É–≥–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—Ä–æ–¥—É –Ω–∞—à–∏—Ö –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–π."
    },
    6: {
        "title": "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–∑–±–∞–≤–ª–µ–Ω–∏—é –æ—Ç –¥–µ—Ñ–µ–∫—Ç–æ–≤",
        "description": "–ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏—Å—å –∫ —Ç–æ–º—É, —á—Ç–æ–±—ã –ë–æ–≥ –∏–∑–±–∞–≤–∏–ª –Ω–∞—Å –æ—Ç –≤—Å–µ—Ö —ç—Ç–∏—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞."
    },
    7: {
        "title": "–°–º–∏—Ä–µ–Ω–∏–µ",
        "description": "–ú—ã —Å–º–∏—Ä–µ–Ω–Ω–æ –ø—Ä–æ—Å–∏–ª–∏ –ï–≥–æ –∏–∑–±–∞–≤–∏—Ç—å –Ω–∞—Å –æ—Ç –Ω–∞—à–∏—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤."
    },
    8: {
        "title": "–°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏—á–∏–Ω—ë–Ω –≤—Ä–µ–¥",
        "description": "–ú—ã —Å–æ—Å—Ç–∞–≤–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ª—é–¥–µ–π, –∫–æ–º—É –º—ã –ø—Ä–∏—á–∏–Ω–∏–ª–∏ –∑–ª–æ, –∏ –ø—Ä–µ–∏—Å–ø–æ–ª–Ω–∏–ª–∏—Å—å –∂–µ–ª–∞–Ω–∏–µ–º –≤–æ–∑–º–µ—Å—Ç–∏—Ç—å –∏–º –≤—Å–µ–º —É—â–µ—Ä–±."
    },
    9: {
        "title": "–í–æ–∑–º–µ—â–µ–Ω–∏–µ —É—â–µ—Ä–±–∞",
        "description": "–ú—ã –Ω–∞–ø—Ä—è–º—É—é –≤–æ–∑–º–µ—â–∞–ª–∏ –ø—Ä–∏—á–∏–Ω—ë–Ω–Ω—ã–π —ç—Ç–∏–º –ª—é–¥—è–º —É—â–µ—Ä–±, –≥–¥–µ —Ç–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ, –∫—Ä–æ–º–µ —Ç–µ—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —ç—Ç–æ –º–æ–≥–ª–æ –Ω–∞–≤—Ä–µ–¥–∏—Ç—å –∏–º –∏–ª–∏ –¥—Ä—É–≥–∏–º –ª—é–¥—è–º."
    },
    10: {
        "title": "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑",
        "description": "–ú—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑, –∏ –∫–æ–≥–¥–∞ –¥–æ–ø—É—Å–∫–∞–ª–∏ –æ—à–∏–±–∫–∏, —Å—Ä–∞–∑—É –ø—Ä–∏–∑–Ω–∞–≤–∞–ª–∏ —ç—Ç–æ."
    },
    11: {
        "title": "–ú–æ–ª–∏—Ç–≤–∞ –∏ –º–µ–¥–∏—Ç–∞—Ü–∏—è",
        "description": "–ü—É—Ç—ë–º –º–æ–ª–∏—Ç–≤—ã –∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –º—ã —Å—Ç—Ä–µ–º–∏–ª–∏—Å—å —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–π —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –ë–æ–≥–æ–º, –∫–∞–∫ –º—ã –ï–≥–æ –ø–æ–Ω–∏–º–∞–µ–º, –º–æ–ª—è—Å—å –ª–∏—à—å –æ –∑–Ω–∞–Ω–∏–∏ –ï–≥–æ –≤–æ–ª–∏ –¥–ª—è –Ω–∞—Å –∏ –æ —Å–∏–ª–µ –¥–ª—è –µ—ë –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è."
    },
    12: {
        "title": "–î—É—Ö–æ–≤–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –∏ —Å–ª—É–∂–µ–Ω–∏–µ",
        "description": "–î–æ—Å—Ç–∏–≥–Ω—É–≤ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤, –º—ã —Å—Ç—Ä–µ–º–∏–ª–∏—Å—å –Ω–µ—Å—Ç–∏ —ç—Ç—É –≤–µ—Å—Ç—å –¥—Ä—É–≥–∏–º –∑–∞–≤–∏—Å–∏–º—ã–º –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤–æ –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –¥–µ–ª–∞—Ö."
    }
}


async def update_step_titles():
    """Update step titles and descriptions in the database."""
    engine = create_async_engine(DATABASE_URL)
    async_session = sessionmaker(engine, expire_on_commit=False, class_=AsyncSession)

    async with async_session() as session:
        async with session.begin():
            # Get all steps
            result = await session.execute(select(Step).order_by(Step.index))
            steps = result.scalars().all()
            
            if not steps:
                print("‚ùå No steps found in database!")
                return
            
            print("üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —à–∞–≥–æ–≤...")
            print("=" * 60)
            
            updated_count = 0
            for step in steps:
                if step.index in STEP_TITLES:
                    step_info = STEP_TITLES[step.index]
                    step.title = step_info["title"]
                    step.description = step_info["description"]
                    updated_count += 1
                    print(f"‚úÖ –®–∞–≥ {step.index}: {step_info['title']}")
            
            await session.commit()
            print("=" * 60)
            print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ {updated_count} —à–∞–≥–æ–≤!")


async def show_steps():
    """Show current step titles."""
    engine = create_async_engine(DATABASE_URL)
    async_session = sessionmaker(engine, expire_on_commit=False, class_=AsyncSession)

    async with async_session() as session:
        result = await session.execute(select(Step).order_by(Step.index))
        steps = result.scalars().all()
        
        print("\nüìä –¢–µ–∫—É—â–∏–µ —à–∞–≥–∏:")
        print("=" * 70)
        for step in steps:
            title = step.title or "‚ùå –ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
            print(f"–®–∞–≥ {step.index:2}: {title}")
        print("=" * 70)


if __name__ == "__main__":
    asyncio.run(update_step_titles())
    asyncio.run(show_steps())

