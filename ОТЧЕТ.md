# –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ä–µ–¥–∏–∑–∞–π–Ω–∞

## ‚úÖ 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –¥–∞—Ç–æ–π (`created_at`, `updated_at`) –∏ —Ç–µ–≥–∞–º–∏ (`tags`)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –í —Ä–∞–∑–¥–µ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –†–∞–±–æ—Ç–∞ = [–Æ—Ä–∏—Å—Ç, –°—É–¥—å—è, –§—Ä–∏–ª–∞–Ω—Å])
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–±–ª–æ–∫–æ–≤ —á–µ—Ä–µ–∑ LLM ‚Äî –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `subblock_name` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°—É–¥—å—è") –∏ `entity_type` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "profession")

**–ì–¥–µ**: `twelvesteps/core/chat_service.py` - —Ñ—É–Ω–∫—Ü–∏—è `process_profile_free_text()` —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –ø–æ–¥–±–ª–æ–∫–æ–≤

---

## ‚úÖ 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–∞
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü–æ–¥–±–ª–æ–∫–∏ ‚Äî –ø–æ–ª–µ `subblock_name` –≤ —Ç–∞–±–ª–∏—Ü–µ `profile_section_data`
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π ‚Äî –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –¥–∞—Ç–∞–º–∏, –º–µ—Ç–æ–¥—ã `get_section_data_history()` –∏ `get_section_data_by_subblock()`
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –í–∞–∂–Ω–æ—Å—Ç—å ‚Äî –ø–æ–ª–µ `importance` (0.0-1.0)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –≠–º–æ—Ü–∏–∏ / –¢–æ–Ω / –¢—Ä–∏–≥–≥–µ—Ä—ã ‚Äî –ø–æ–ª–µ `tags` (—Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –§–ª–∞–≥ "–≤—Ö–æ–¥–∏—Ç –≤ —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏" ‚Äî –ø–æ–ª–µ `is_core_personality` (boolean)

**–ì–¥–µ**: 
- –ú–æ–¥–µ–ª—å: `twelvesteps/db/models.py` - –∫–ª–∞—Å—Å `ProfileSectionData`
- –ú–∏–≥—Ä–∞—Ü–∏—è: `twelvesteps/alembic/versions/m9n0o1p2q3r4_add_profile_section_data_history.py`

---

## ‚úÖ 3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (UI)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤—Ä—É—á–Ω—É—é ‚Äî API `POST /profile/sections/{section_id}/data`, –∫–Ω–æ–ø–∫–∞ "‚ûï –î–æ–±–∞–≤–∏—Ç—å" –≤ Telegram –±–æ—Ç–µ
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å ‚Äî API `PUT /profile/section-data/{data_id}`, –∫–Ω–æ–ø–∫–∞ "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∑–∞–ø–∏—Å–∏
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø–∏—Å–µ–π ‚Äî API `GET /profile/sections/{section_id}/history`, –∫–Ω–æ–ø–∫–∞ "üóÉÔ∏è –ò—Å—Ç–æ—Ä–∏—è" –≤ –º–µ–Ω—é —Ä–∞–∑–¥–µ–ª–∞

**–ì–¥–µ**:
- API: `twelvesteps/api/main.py` - endpoints –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- UI: `twelvesteps_tgbot/bot/handlers.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback'–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–Ω–æ–ø–∫–∏: `twelvesteps_tgbot/bot/config.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `build_profile_actions_markup()`, `build_section_history_markup()`, `build_entry_detail_markup()`

---

## ‚úÖ 4. Personalization Service (prompts)
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `is_core_personality` ‚Üí `importance` ‚Üí `created_at`
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –§–æ—Ä–º–∞—Ç "–°–µ–π—á–∞—Å / –†–∞–Ω–µ–µ" ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–°–µ–π—á–∞—Å", –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫–∞–∫ "–†–∞–Ω–µ–µ"
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ ‚Äî —Ç–æ–ø-3 –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø–æ–¥–±–ª–æ–∫, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–∞–∂–Ω–æ—Å—Ç—å –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞

**–ì–¥–µ**: `twelvesteps/services/personalization_service.py` - —Ñ—É–Ω–∫—Ü–∏—è `update_personalized_prompt_from_all_answers()`, —Å—Ç—Ä–æ–∫–∏ 221-254

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤ –ø—Ä–æ–º–ø—Ç–µ**:
```
[–†–∞–±–æ—Ç–∞]
  ‚Ä¢ –§—Ä–∏–ª–∞–Ω—Å (profession):
    –°–µ–π—á–∞—Å: —Å–µ–π—á–∞—Å —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä
  ‚Ä¢ –°—É–¥—å—è (profession):
    –†–∞–Ω–µ–µ: —Å—Ç–∞–ª —Å—É–¥—å–µ–π –Ω–∞ 8 –ª–µ—Ç
  ‚Ä¢ –Æ—Ä–∏—Å—Ç (profession):
    –†–∞–Ω–µ–µ: —Ä–∞–±–æ—Ç–∞–ª —é—Ä–∏—Å—Ç–æ–º 6 –ª–µ—Ç
```

---

## ‚úÖ 5. –í–ª–∏—è–Ω–∏–µ –Ω–∞ —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–º–ø—Ç ‚Äî –∑–∞–ø–∏—Å–∏ —Å `is_core_personality=True` –ø–æ–º–µ—á–∞—é—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç–µ –∫–∞–∫ "[—è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏]"
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ stable memory ‚Äî —á–µ—Ä–µ–∑ `update_personalized_prompt_from_all_answers()` ‚Üí `User.personal_prompt`
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ‚Äî –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ì–¥–µ**: 
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞: `twelvesteps/api/main.py` - endpoints —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤—ã–∑—ã–≤–∞—é—Ç `update_personalized_prompt_from_all_answers()`
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞: `twelvesteps/services/personalization_service.py`

---

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –¢–∞–±–ª–∏—Ü–∞ `profile_section_data` —Å –ø–æ–ª—è–º–∏: `subblock_name`, `entity_type`, `importance`, `is_core_personality`, `tags`
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø–æ–¥–±–ª–æ–∫–∞–º –∏ —è–¥—Ä—É –ª–∏—á–Ω–æ—Å—Ç–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

### API Endpoints
- `GET /profile/sections/{section_id}/history` - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π —Ä–∞–∑–¥–µ–ª–∞
- `POST /profile/sections/{section_id}/data` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `PUT /profile/section-data/{data_id}` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `DELETE /profile/section-data/{data_id}` - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

### UI –≤ Telegram –±–æ—Ç–µ
- –ö–Ω–æ–ø–∫–∏ –≤ –º–µ–Ω—é —Ä–∞–∑–¥–µ–ª–∞: "üóÉÔ∏è –ò—Å—Ç–æ—Ä–∏—è", "‚ûï –î–æ–±–∞–≤–∏—Ç—å", "‚úçÔ∏è –°–≤–æ–±–æ–¥–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑"
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "üóë –£–¥–∞–ª–∏—Ç—å"
- –ö–Ω–æ–ø–∫–∏ –≤ –º–∏–Ω–∏-–æ–ø—Ä–æ—Å–µ: "üóÉÔ∏è –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥–µ–ª–∞", "‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª"

---

## ‚úÖ –ò—Ç–æ–≥

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å)
- ‚úÖ –ü–æ–¥–±–ª–æ–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö
- ‚úÖ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏
- ‚úÖ –£–º–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç–µ
- ‚úÖ –í–ª–∏—è–Ω–∏–µ –Ω–∞ —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

